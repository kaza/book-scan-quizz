{% extends "base.html" %}

{% block title %}Quiz Question - Book-Scan-Quizz{% endblock %}

{% block content %}
<div class="container">
    <h1 class="mb-4">Question</h1>
    <p id="question-text" class="lead mb-4">{{ question.question_text }}</p>

    <!-- TTS controls -->
    <div id="tts-controls" class="mb-4">
        <div class="form-check">
            <input class="form-check-input" type="checkbox" id="autoReadResults">
            <label class="form-check-label" for="autoReadResults">
                Automatically read results aloud
            </label>
        </div>
        <label for="voice-select" class="form-label">Select Voice:</label>
        <select id="voice-select" class="form-select">
            <!-- Voice options will be populated by JavaScript -->
        </select>
    </div>

    <!-- Text display area for spoken text -->
    <div id="spoken-text-display" class="alert alert-info mt-3" style="display: none;"></div>

    <p class="mb-4">Press and hold the button to record your answer.</p>

    <div class="text-center my-4">
        <button id="recordButton" class="btn btn-lg btn-success rounded-circle" style="width: 100px; height: 100px;">
            Record
        </button>
    </div>

    <div id="recordingFeedback" class="text-center my-2" style="display: none;">
        Recording... <span id="recordingDuration">0</span>s
    </div>

    <div id="audioVisualization" class="mt-3" style="display: none;">
        <div class="progress">
            <div id="audioMeter" class="progress-bar bg-info" role="progressbar" style="width: 0%;" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100"></div>
        </div>
    </div>

    <div id="processingFeedback" class="text-center my-2" style="display: none;">
        Processing your audio...
    </div>

    <div id="resultContainer" class="mt-4">
        <h3>Result:</h3>
        <p id="resultText"></p>
    </div>

    <!-- New buttons for retry and next question -->
    <div id="actionButtons" class="text-center mt-4" style="display: none;">
        <button id="retryButton" class="btn btn-warning me-2">Retry</button>
        <button id="nextQuestionButton" class="btn btn-primary">Next Question</button>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="{{ url_for('static', filename='js/text_to_speech.js') }}"></script>
<script src="{{ url_for('static', filename='js/audio_recording.js') }}"></script>
<script src="{{ url_for('static', filename='js/quiz_session.js') }}"></script>
<script>
document.addEventListener('DOMContentLoaded', function() {
    initAudioRecording('{{ url_for("quiz_session.evaluate_audio") }}', '{{ question.id }}', '{{ session_id }}');
    // Set up the next question URL for the quiz_session.js
    window.nextQuestionUrl = '{{ url_for("quiz_session.answer_question", session_id=session_id) }}';
});
</script>
{% endblock %}